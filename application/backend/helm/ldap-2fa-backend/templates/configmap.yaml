apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ldap-2fa-backend.fullname" . }}-config
  labels:
    {{- include "ldap-2fa-backend.labels" . | nindent 4 }}
data:
  # LDAP Configuration
  LDAP_HOST: {{ .Values.ldap.host | quote }}
  LDAP_PORT: {{ .Values.ldap.port | quote }}
  LDAP_USE_SSL: {{ .Values.ldap.useSsl | quote }}
  LDAP_BASE_DN: {{ .Values.ldap.baseDn | quote }}
  LDAP_ADMIN_DN: {{ .Values.ldap.adminDn | quote }}
  LDAP_USER_SEARCH_BASE: {{ .Values.ldap.userSearchBase | quote }}
  LDAP_USER_SEARCH_FILTER: {{ .Values.ldap.userSearchFilter | quote }}
  LDAP_ADMIN_GROUP_DN: {{ .Values.ldapAdmin.groupDn | quote }}
  LDAP_USERS_GID: {{ .Values.ldapAdmin.usersGid | quote }}
  LDAP_UID_START: {{ .Values.ldapAdmin.uidStart | quote }}

  # Database Configuration
  {{- if not .Values.database.externalSecret.enabled }}
  DATABASE_URL: {{ .Values.database.url | quote }}
  {{- end }}

  # Email/SES Configuration
  ENABLE_EMAIL_VERIFICATION: {{ .Values.email.enabled | quote }}
  SES_SENDER_EMAIL: {{ .Values.email.senderEmail | quote }}
  EMAIL_VERIFICATION_EXPIRY_HOURS: {{ .Values.email.verificationExpiryHours | quote }}
  APP_URL: {{ .Values.email.appUrl | quote }}

  # MFA/TOTP Configuration
  TOTP_ISSUER: {{ .Values.mfa.issuer | quote }}
  TOTP_DIGITS: {{ .Values.mfa.digits | quote }}
  TOTP_INTERVAL: {{ .Values.mfa.interval | quote }}
  TOTP_ALGORITHM: {{ .Values.mfa.algorithm | quote }}

  # SMS/SNS Configuration
  ENABLE_SMS_2FA: {{ .Values.sms.enabled | quote }}
  AWS_REGION: {{ .Values.sms.awsRegion | quote }}
  SNS_TOPIC_ARN: {{ .Values.sms.snsTopicArn | quote }}
  SMS_SENDER_ID: {{ .Values.sms.senderId | quote }}
  SMS_TYPE: {{ .Values.sms.smsType | quote }}
  SMS_CODE_LENGTH: {{ .Values.sms.codeLength | quote }}
  SMS_CODE_EXPIRY_SECONDS: {{ .Values.sms.codeExpirySeconds | quote }}
  SMS_MESSAGE_TEMPLATE: {{ .Values.sms.messageTemplate | quote }}

  # Application Configuration
  APP_NAME: {{ .Values.app.name | quote }}
  DEBUG: {{ .Values.app.debug | quote }}
  LOG_LEVEL: {{ .Values.app.logLevel | quote }}
  CORS_ORIGINS: {{ .Values.app.corsOrigins | quote }}

  # Redis Configuration
  REDIS_ENABLED: {{ .Values.redis.enabled | quote }}
  REDIS_HOST: {{ .Values.redis.host | quote }}
  REDIS_PORT: {{ .Values.redis.port | quote }}
  REDIS_DB: {{ .Values.redis.db | quote }}
  REDIS_SSL: {{ .Values.redis.ssl | quote }}
  REDIS_KEY_PREFIX: {{ .Values.redis.keyPrefix | quote }}
